<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ajax的基本用法</title>
</head>
<body>
  <script>
    //1. XMLHttpRequest
    //Ajax想要实现浏览器与服务器之间的异步通信，需要依靠XMLHttpRequest，它是一个构造函数

    //不论是XMLHttpRequest, 还是Ajax, 都没有和具体的某种数据格式绑定

    //2.Ajax的使用步骤
    //2.1 创建xhr对象
    /*
    const xhr = new XMLHttpRequest();


    
    xhr.onreadystatechange = ()=>{
      if(xhr.readyState !== 4) return;

      //HTTP CODE
      //获取到响应后，响应的内容会自动填充xhr对象的属性
      // xhr.status：HTTP状态码
      //xhr.statusText：HTTP状态说明
      if((xhr.status >= 200 && xhr.status < 300) || xhr.status === 304){
        console.log('正常使用响应数据');
        console.log(xhr.responseText);
      }
      else{
        //错误处理
      }
    };
    */

    //2.2 准备发送请求
    //xhr.open('HTTP方法：GET|POST|PUT|DELETE', '地址URL', true);

    //调用open并不会真正发送请求，而只是做好发送请求前的准备工作

    //2.3 发送请求
    //调用send()正式发送请求
    //xhr.send();

    //send()的参数是通过请求体携带的数据
    //如果是GET的话，xhr.send(null); 确保兼容性

    //2.4 监听时间，处理响应
    //当获取响应后，会触发xhr对象的readystatechange事件，可以在该事件中中对相应进行处理


    //readystatechange事件也可以配合addEventListener使用，不过要注意，IE6~8不支持addEventListener
    //为了兼容性，readystatechange中不适用this,而是直接使用xhr

    //xhr.addEventListener('readystatechange', ()=>{}, false);
    //由于兼容性的原因，最好放在open之前

    //readystatechange事件监听readyState这个状态的变化
    //它的值从0~4，一共5个状态
    //0: 未初始化。尚未调用open()
    //1：启动。已经调用open(), 但尚未调用send()
    //2：发送。已经调用send()，但尚未接收相应
    //3：接收。已经接收部分响应数据
    //4: 完成。已经接收到全部响应数据，而且已经可以在浏览器中使用了。


    //3. 使用Ajax完成前后端的通信
    const url = "https://www.imooc.com/api/http/search/suggest?words=js";

    const xhr = new XMLHttpRequest();

    xhr.onreadystatechange = ()=>{
      if(xhr.readyState !== 4) return;

      if((xhr.status >= 200 && xhr.status < 300) || xhr.status === 304){
        console.log(xhr.responseText);
        console.log(typeof xhr.responseText);
      }
    }

    xhr.open('GET', url, true);
    xhr.send(null);
  </script>
</body>
</html>